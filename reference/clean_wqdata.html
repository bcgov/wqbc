<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Clean Water Quality Data — clean_wqdata • wqbc</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Clean Water Quality Data — clean_wqdata" />
<meta property="og:description" content="Cleans water quality data. After standardization using standardize_wqdata
replicates (two or more readings for the same variable on the same date) are averaged
using the mean function.
Readings for the same variable on the same date but at different levels of the
columns specified in by are not considered replicates. The clean_wqdata
function is automatically called by calc_limits prior
to calculating limits." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wqbc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/wqbc.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bcgov/wqbc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Clean Water Quality Data</h1>
    <small class="dont-index">Source: <a href='https://github.com/bcgov/wqbc/blob/master/R/clean-wqdata.R'><code>R/clean-wqdata.R</code></a></small>
    <div class="hidden name"><code>clean_wqdata.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Cleans water quality data. After standardization using <code><a href='standardize_wqdata.html'>standardize_wqdata</a></code>
replicates (two or more readings for the same variable on the same date) are averaged
using the <code>mean</code> function.
Readings for the same variable on the same date but at different levels of the
columns specified in by are not considered replicates. The <code>clean_wqdata</code>
function is automatically called by <code><a href='calc_limits.html'>calc_limits</a></code> prior
to calculating limits.</p>
    </div>

    <pre class="usage"><span class='fu'>clean_wqdata</span><span class='op'>(</span>
  <span class='va'>x</span>,
  by <span class='op'>=</span> <span class='cn'>NULL</span>,
  max_cv <span class='op'>=</span> <span class='cn'>Inf</span>,
  sds <span class='op'>=</span> <span class='fl'>10</span>,
  ignore_undetected <span class='op'>=</span> <span class='cn'>TRUE</span>,
  large_only <span class='op'>=</span> <span class='cn'>TRUE</span>,
  delete_outliers <span class='op'>=</span> <span class='cn'>FALSE</span>,
  remove_blanks <span class='op'>=</span> <span class='cn'>FALSE</span>,
  messages <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"wqbc.messages"</span>, default <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  FUN <span class='op'>=</span> <span class='va'>mean</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>The data.frame to clean.</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>A character vector of the columns in x to perform the cleaning by.
If you have multiple stations specify the column name that contains the station IDs.</p></td>
    </tr>
    <tr>
      <th>max_cv</th>
      <td><p>A number indicating the maximum permitted coefficient
of variation for replicates.</p></td>
    </tr>
    <tr>
      <th>sds</th>
      <td><p>The number of standard deviations above which a value is considered an outlier.</p></td>
    </tr>
    <tr>
      <th>ignore_undetected</th>
      <td><p>A flag indicating whether to ignore undetected values when calculating the average deviation and identifying outliers.</p></td>
    </tr>
    <tr>
      <th>large_only</th>
      <td><p>A flag indicating whether only large values which exceed the sds should be identified as outliers.</p></td>
    </tr>
    <tr>
      <th>delete_outliers</th>
      <td><p>A flag indicating whether to delete outliers or merely flag them.</p></td>
    </tr>
    <tr>
      <th>remove_blanks</th>
      <td><p>Should blanks be removed? Blanks are assumed to be denoted by
a value of <code>"Blank..."</code> in the <code>SAMPLE_CLASS</code> column. Default <code>FALSE</code></p></td>
    </tr>
    <tr>
      <th>messages</th>
      <td><p>A flag indicating whether to print messages.</p></td>
    </tr>
    <tr>
      <th>FUN</th>
      <td><p>The function to use for summaries, e.g. <code>median</code>, <code>mean</code>, or <code>max</code>. Default <code>mean</code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If there are three or more replicates with a coefficient of variation (CV) in
exceedance of <code>max_cv</code> then the replicates with the highest absolute deviation
is dropped until the CV is less than or equal to <code>max_cv</code>
or only two values remain. By default all values are averaged.</p>
<p>A max_cv value of 1.29
is exceeded by two zero and one positive value (CV = 1.73)
or by two identical positive values and a third value an order
or magnitude greater (CV = 1.30). It is not exceed by one zero
and two identical positive values (CV = 0.87).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='calc_limits.html'>calc_limits</a></code> and <code><a href='standardize_wqdata.html'>standardize_wqdata</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>clean_wqdata</span><span class='op'>(</span><span class='fu'>wqbc</span><span class='fu'>::</span><span class='va'><a href='dummy.html'>dummy</a></span>, messages <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Cleaning water quality data...</span></div><div class='output co'>#&gt; <span class='message'>Identified 0 outliers in water quality data.</span></div><div class='output co'>#&gt; <span class='message'>Cleansed water quality data.</span></div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 9 x 6</span><span>
#&gt;   Date       Variable              Value Units    Outlier DetectionLimit
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;date&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                 </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;lgl&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> 2000-01-01 Aluminium Dissolved    7.67 mg/L     FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>2</span><span> 2000-01-04 Aluminium Dissolved </span><span style='text-decoration: underline;'>1</span><span>000.   ug/L     FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>3</span><span> 2000-01-05 Aluminium Dissolved   20.5  mg/L     FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>4</span><span> 2000-01-06 Aluminium Dissolved   15    mg/L     FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>5</span><span> 2000-01-02 DISSOLVED ALUMINUM  </span><span style='text-decoration: underline;'>1</span><span>000.   MG/L     FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>6</span><span> 1978-12-01 Kryptonite             1    ug/L     FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>7</span><span> 1978-12-01 pH                     7    PH UNITS FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>8</span><span> 2000-01-01 pH                     8.75 PH UNITS FALSE               </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #555555;'>9</span><span> 1977-05-25 Zinc Total           500.   ug/L     FALSE               </span><span style='color: #BB0000;'>NA</span><span></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joe Thorley, Colin Millar, Andy Teucher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


