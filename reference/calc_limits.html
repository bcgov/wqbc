<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate Limits — calc_limits • wqbc</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate Limits — calc_limits" />
<meta property="og:description" content="Calculates the approved &quot;short&quot; or &quot;long&quot;-term
upper water quality thresholds for freshwater life in British Columbia.
The water quality data is automatically cleaned using clean_wqdata
prior to calculating the limits to ensure: all variables are recognised,
all values are non-negative and in the standard units, divergent replicates
are filtered and all remaining replicates are averaged. Only limits whose
conditions are met are returned.
Note to use the long-term limits on daily values set
term = &quot;long-daily&quot;." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wqbc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/wqbc.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bcgov/wqbc/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Limits</h1>
    <small class="dont-index">Source: <a href='https://github.com/bcgov/wqbc/blob/master/R/calc-limits.R'><code>R/calc-limits.R</code></a></small>
    <div class="hidden name"><code>calc_limits.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculates the approved "short" or "long"-term
upper water quality thresholds for freshwater life in British Columbia.
The water quality data is automatically cleaned using <code><a href='clean_wqdata.html'>clean_wqdata</a></code>
prior to calculating the limits to ensure: all variables are recognised,
all values are non-negative and in the standard units, divergent replicates
are filtered and all remaining replicates are averaged. Only limits whose
conditions are met are returned.
Note to use the long-term limits on daily values set
term = "long-daily".</p>
    </div>

    <pre class="usage"><span class='fu'>calc_limits</span><span class='op'>(</span>
  <span class='va'>x</span>,
  by <span class='op'>=</span> <span class='cn'>NULL</span>,
  term <span class='op'>=</span> <span class='st'>"long"</span>,
  dates <span class='op'>=</span> <span class='cn'>NULL</span>,
  keep_limits <span class='op'>=</span> <span class='cn'>TRUE</span>,
  delete_outliers <span class='op'>=</span> <span class='cn'>FALSE</span>,
  estimate_variables <span class='op'>=</span> <span class='cn'>FALSE</span>,
  clean <span class='op'>=</span> <span class='cn'>TRUE</span>,
  limits <span class='op'>=</span> <span class='fu'>wqbc</span><span class='fu'>::</span><span class='va'><a href='limits.html'>limits</a></span>,
  messages <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"wqbc.messages"</span>, default <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
  use <span class='op'>=</span> <span class='st'>"Freshwater Life"</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A data.frame of water quality readings to calculate the limits for.</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>A optional character vector of the columns in x to calculate the limits by.</p></td>
    </tr>
    <tr>
      <th>term</th>
      <td><p>A string indicating whether to calculate the "long" or "short"-term limits.</p></td>
    </tr>
    <tr>
      <th>dates</th>
      <td><p>A optional date vector indicating the start of 30 day long-term periods.</p></td>
    </tr>
    <tr>
      <th>keep_limits</th>
      <td><p>A flag indicating whether to keep values with user supplied upper or lower limits.</p></td>
    </tr>
    <tr>
      <th>delete_outliers</th>
      <td><p>A flag indicating whether to delete outliers or merely flag them.</p></td>
    </tr>
    <tr>
      <th>estimate_variables</th>
      <td><p>A flag indicating whether to estimate total hardness, total chloride and pHfor all dates.</p></td>
    </tr>
    <tr>
      <th>clean</th>
      <td><p>Should the data be run through <code><a href='clean_wqdata.html'>clean_wqdata</a></code> before calculating limits? Default <code>TRUE</code></p></td>
    </tr>
    <tr>
      <th>limits</th>
      <td><p>A data frame of the limits table to use.</p></td>
    </tr>
    <tr>
      <th>messages</th>
      <td><p>A flag indicating whether to print messages.</p></td>
    </tr>
    <tr>
      <th>use</th>
      <td><p>A string indicating the Use.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>If a limit depends on another variable
such as pH, Total Chloride, or Total Hardness and no value was recorded for the date of interest
then the pH, Total Chloride or Total Hardness value is assumed to be the
average recorded value over the 30 day period.
The one exception is if <code>estimate_variables = TRUE</code> in which case a parametric model
is used to predict the pH, Total Chloride and Total Hardness for all dates with a value of any variable.
Existing values are replaced.
If, in every year, there are less then 12 pH/Total Chloride/Total Hardness then an average value is taken.
Otherwise, if there is only one year with 12 or more values a simple seasonal smoother is used.
If there is two years with 12 or more values then a seasonal smoother with a trend is fitted.
Otherwise a model with trend and a dynamic seasonal component is fitted.</p>
<p>When considering long-term limits there must be at least 5 values
spanning 21 days. As replicates are averaged prior to calculating the limits
each of the 5 values must be on a separate day. The first 30 day period
begin at the date of the first reading while the next 30 day period
starts at the date of the first reading after the previous period and so on.
The only exception to this is if the user provides dates in which case each
period extends for 30 days or until a provided date is reached. It is important
to note that the averaging of conditional variables, the 5 in 30 rule
and the assignment of 30 day periods occurs independently for all combination
of factor levels in the columns specified by by.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='clean_wqdata.html'>clean_wqdata</a></code> and <code><a href='lookup_limits.html'>lookup_limits</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/utils/demo.html'>demo</a></span><span class='op'>(</span><span class='va'>fraser</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joe Thorley, Colin Millar, Andy Teucher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


